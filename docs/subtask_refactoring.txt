================================================================================
ğŸ“‹ PLANEJAMENTO: REFATORAÃ‡ÃƒO DE SUBTASK PARA ARQUITETURA MODULAR
================================================================================
Data: 2025-10-21
Status: âš ï¸ DOCUMENTAÃ‡ÃƒO - AGUARDANDO IMPLEMENTAÃ‡ÃƒO

================================================================================
ğŸ¯ OBJETIVO
================================================================================

Refatorar `CleanSubtaskItem` (~400 linhas) para usar `ModularCard` + mÃ³dulos 
reutilizÃ¡veis, seguindo o padrÃ£o elegante do `TaskCard`.

RESULTADO ESPERADO:
- ReduÃ§Ã£o de 400+ linhas â†’ ~80 linhas
- CÃ³digo modular, reutilizÃ¡vel e manutenÃ­vel
- Visual limpo: checkbox circular + sem bordas + layout clean
- Menu de contexto responsivo (desktop/mobile)

================================================================================
ğŸ§© ARQUITETURA PROPOSTA
================================================================================

SubtaskCard (ModularCard)
â”œâ”€â”€ Checkbox Circular (leading) - INLINE, nÃ£o Ã© mÃ³dulo
â”œâ”€â”€ TextField EditÃ¡vel (title)
â”œâ”€â”€ Tempo Acumulado (content) - condicional
â”œâ”€â”€ PomodoroTimerModule (actions) - mÃ³dulo existente âœ…
â””â”€â”€ ContextMenuModule (contextMenu) - mÃ³dulo novo ğŸ†•

================================================================================
ğŸ“¦ MÃ“DULOS E ARQUIVOS
================================================================================

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. CRIAR: context_menu_module.dart                                          â”‚
â”‚    lib/widgets/common/modules/context_menu_module.dart                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

RESPONSABILIDADE:
- Menu de contexto genÃ©rico e reutilizÃ¡vel
- Suporta clique direito (desktop) + toque longo (mobile)
- Widget wrapper que adiciona gestos ao child
- Lista configurÃ¡vel de aÃ§Ãµes (edit, delete, etc.)

FUNCIONALIDADES:
âœ… showMenu() para desktop (clique direito com posiÃ§Ã£o especÃ­fica)
âœ… showModalBottomSheet() para mobile (toque longo)
âœ… Lista de ContextMenuItem configurÃ¡vel
âœ… Callback onActionSelected(String action)
âœ… Suporte a aÃ§Ãµes destrutivas (vermelho)
âœ… Suporte a dividers entre aÃ§Ãµes

API PROPOSTA:
```dart
ContextMenuModule(
  items: [
    ContextMenuItem(value: 'edit', label: 'Editar', icon: Icons.edit),
    ContextMenuItem.divider(),
    ContextMenuItem(
      value: 'delete', 
      label: 'Excluir', 
      icon: Icons.delete,
      isDestructive: true,
    ),
  ],
  onActionSelected: (action) {
    if (action == 'edit') handleEdit();
    if (action == 'delete') handleDelete();
  },
  child: MyWidget(), // Widget que receberÃ¡ os gestos
)
```

FACTORIES ÃšTEIS:
```dart
// AÃ§Ãµes prÃ©-configuradas comuns
ContextMenuModule.editDelete({
  required VoidCallback onEdit,
  required VoidCallback onDelete,
  required Widget child,
})

ContextMenuModule.custom({
  required List<ContextMenuItem> items,
  required Function(String) onActionSelected,
  required Widget child,
})
```

INSPIRAÃ‡ÃƒO:
- list_context_menu.dart (desktop + mobile)
- project_context_menu.dart (validaÃ§Ãµes)
- action_menu_module.dart (PopupMenuButton base)

DECISÃƒO: âŒ DISPENSAR edit_delete_module.dart
MOTIVO: Redundante - ContextMenuModule.editDelete() factory jÃ¡ resolve


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. CRIAR: subtask_card.dart                                                 â”‚
â”‚    lib/widgets/common/cards/subtask_card.dart                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

RESPONSABILIDADE:
- Card de subtarefa usando ModularCard como base
- Layout limpo sem bordas (background transparente)
- Checkbox circular inline (nÃ£o Ã© mÃ³dulo separado)
- IntegraÃ§Ã£o com PomodoroTimerModule (jÃ¡ existe)
- IntegraÃ§Ã£o com ContextMenuModule (menu edit/delete)

SLOTS DO MODULARCARD:
â”œâ”€â”€ leading: Checkbox circular (24x24, verde quando completo)
â”œâ”€â”€ title: Text com tÃ­tulo da subtarefa (lineThrough se completo)
â”œâ”€â”€ content: Tempo acumulado (condicional, sÃ³ se > 0)
â”œâ”€â”€ actions: PomodoroTimerModule
â””â”€â”€ contextMenu: ContextMenuModule.editDelete()

PROPS:
- subtask: Task (objeto completo da subtarefa)
- controller: TaskController (para operaÃ§Ãµes)
- onToggleComplete: VoidCallback? (marcar/desmarcar)
- onEdit: VoidCallback? (abrir dialog de ediÃ§Ã£o)
- onDelete: VoidCallback? (excluir subtarefa)

VISUAL ESPERADO (conforme imagem anexada):
âœ… Checkbox circular Ã  esquerda
âœ… Texto editÃ¡vel no centro
âœ… Tempo acumulado (se houver) antes do timer
âœ… BotÃ£o timer play/stop Ã  direita
âœ… Menu de contexto (clique direito/toque longo)
âœ… SEM bordas, SEM sombras, background transparente

EXEMPLO DE CÃ“DIGO:
```dart
class SubtaskCard extends StatelessWidget {
  final Task subtask;
  final TaskController controller;
  final VoidCallback? onToggleComplete;
  final VoidCallback? onEdit;
  final VoidCallback? onDelete;

  @override
  Widget build(BuildContext context) {
    return ContextMenuModule.editDelete(
      onEdit: onEdit ?? () {},
      onDelete: onDelete ?? () {},
      child: ModularCard(
        backgroundColor: Colors.transparent,
        elevation: 0,
        borderRadius: BorderRadius.zero,
        
        // Checkbox circular inline
        leading: GestureDetector(
          onTap: onToggleComplete,
          child: Container(
            width: 24,
            height: 24,
            decoration: BoxDecoration(
              shape: BoxShape.circle,
              border: Border.all(
                color: subtask.isCompleted 
                  ? Colors.green 
                  : Colors.grey.shade400,
                width: 2,
              ),
              color: subtask.isCompleted 
                ? Colors.green 
                : Colors.transparent,
            ),
            child: subtask.isCompleted
              ? Icon(Icons.check, size: 16, color: Colors.white)
              : null,
          ),
        ),
        
        title: Text(
          subtask.title,
          style: TextStyle(
            fontSize: 14,
            decoration: subtask.isCompleted 
              ? TextDecoration.lineThrough 
              : null,
            color: subtask.isCompleted 
              ? Colors.grey.shade600 
              : null,
          ),
        ),
        
        content: subtask.accumulatedTimeSeconds > 0 
          ? _buildTimeDisplay()
          : null,
        
        actions: PomodoroTimerModule(
          task: subtask,
          listTitle: controller.getListById(subtask.listId)?.name,
          targetSeconds: subtask.pomodoroTimeMinutes * 60,
          color: Theme.of(context).colorScheme.primary,
          shouldLog: true,
        ),
      ),
    );
  }
}
```


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. ALTERAR: modular_card.dart                                               â”‚
â”‚    lib/widgets/common/cards/modular_card.dart                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

MUDANÃ‡AS NECESSÃRIAS:
âŒ NENHUMA! 

DECISÃƒO REVISADA:
ApÃ³s anÃ¡lise, ContextMenuModule deve ENVOLVER o ModularCard, nÃ£o ser parte dele.
Isso mantÃ©m ModularCard focado apenas em layout, e ContextMenuModule focado 
apenas em gestos.

PADRÃƒO:
```dart
ContextMenuModule(
  items: [...],
  onActionSelected: (action) => ...,
  child: ModularCard(...), // Card Ã© o child do menu
)
```

VANTAGEM: SeparaÃ§Ã£o de responsabilidades clara


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. ALTERAR: clean_subtask_item.dart                                         â”‚
â”‚    lib/features/task_management/widgets/tasks/detail/clean_subtask_item.dartâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ESTRATÃ‰GIA: Manter compatibilidade mas usar nova implementaÃ§Ã£o

ANTES: ~400 linhas com lÃ³gica complexa
DEPOIS: ~30 linhas delegando para SubtaskCard

CÃ“DIGO:
```dart
class CleanSubtaskItem extends StatelessWidget {
  final Task subtask;
  final TaskController taskController;
  final TextEditingController textController; // âš ï¸ NÃ£o usado no novo design
  final VoidCallback onToggleComplete;
  final VoidCallback onDelete;
  final Function(String) onTitleChanged; // âš ï¸ NÃ£o usado no novo design

  @override
  Widget build(BuildContext context) {
    return SubtaskCard(
      subtask: subtask,
      controller: taskController,
      onToggleComplete: onToggleComplete,
      onEdit: () => _showEditDialog(context),
      onDelete: onDelete,
    );
  }
  
  void _showEditDialog(BuildContext context) {
    showDialog(
      context: context,
      builder: (context) => SubtaskEditDialog(
        subtask: subtask, 
        controller: taskController,
      ),
    );
  }
}
```

BREAKING CHANGES:
âš ï¸ textController nÃ£o Ã© mais usado (tÃ­tulo editado via dialog)
âš ï¸ onTitleChanged nÃ£o Ã© mais usado (ediÃ§Ã£o via dialog)

MITIGAÃ‡ÃƒO:
Manter assinaturas antigas para compatibilidade mas ignorar internamente


================================================================================
ğŸ¨ DESIGN VISUAL (CONFORME IMAGEM)
================================================================================

Layout horizontal:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [â—‹] TÃ­tulo da subtarefa                          00:03 [â–¶]  [â‹®]            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†‘   â†‘                                             â†‘     â†‘    â†‘
  â”‚   â”‚                                             â”‚     â”‚    â””â”€ Menu (3 pontos)
  â”‚   â””â”€ TÃ­tulo (com lineThrough se completo)      â”‚     â””â”€ Play/Stop timer
  â””â”€ Checkbox circular (verde se completo)         â””â”€ Tempo acumulado

ESTADOS:
- Normal: checkbox vazio + texto preto + sem tempo
- Completo: checkbox verde âœ“ + texto riscado cinza + tempo parado
- Timer ativo: checkbox ? + botÃ£o stop vermelho + tempo contando
- Hover: mostra menu de 3 pontos

SEM:
âŒ Bordas no card
âŒ Sombras
âŒ Background colorido
âŒ Padding excessivo


================================================================================
ğŸ“Š COMPARAÃ‡ÃƒO ANTES/DEPOIS
================================================================================

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MÃ‰TRICA              â”‚ ANTES (CleanSubtaskItem)  â”‚ DEPOIS (SubtaskCard)     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Linhas de cÃ³digo     â”‚ ~400 linhas               â”‚ ~80 linhas               â”‚
â”‚ Componentes inline   â”‚ Todos (checkbox, timer)   â”‚ Apenas checkbox          â”‚
â”‚ MÃ³dulos usados       â”‚ 0 (tudo custom)           â”‚ 2 (Pomodoro + Context)   â”‚
â”‚ LÃ³gica de menu       â”‚ 150 linhas inline         â”‚ 0 (delegado)             â”‚
â”‚ LÃ³gica de timer      â”‚ 100 linhas inline         â”‚ 0 (delegado)             â”‚
â”‚ Testabilidade        â”‚ Baixa (tudo acoplado)     â”‚ Alta (mÃ³dulos isolados)  â”‚
â”‚ ReutilizaÃ§Ã£o         â”‚ 0% (tudo especÃ­fico)      â”‚ 80% (mÃ³dulos genÃ©ricos)  â”‚
â”‚ Manutenibilidade     â”‚ DifÃ­cil (elefante)        â”‚ FÃ¡cil (modular)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


================================================================================
ğŸ”„ REUTILIZAÃ‡ÃƒO DOS MÃ“DULOS
================================================================================

ContextMenuModule pode ser usado em:
âœ… SubtaskCard (edit/delete)
âœ… TaskCard (edit/delete/duplicate/move)
âœ… NoteCard (edit/delete/share)
âœ… HabitCard (edit/delete/reset)
âœ… ProjectCard (edit/delete/archive)
âœ… ListCard (edit/delete/color)
âœ… Qualquer widget que precise de menu de contexto

PomodoroTimerModule jÃ¡ Ã© usado em:
âœ… TaskCard
âœ… HabitCard
âœ… SubtaskCard (novo)


================================================================================
ğŸš€ PLANO DE IMPLEMENTAÃ‡ÃƒO
================================================================================

FASE 1: Criar mÃ³dulos base
â”œâ”€â”€ 1.1. Criar context_menu_module.dart
â”‚        - ContextMenuModule widget
â”‚        - ContextMenuItem model
â”‚        - Factories (editDelete, custom)
â”‚        - Testes de gestos (desktop + mobile)
â”‚
â””â”€â”€ 1.2. Criar subtask_card.dart
         - SubtaskCard usando ModularCard
         - Checkbox circular inline
         - IntegraÃ§Ã£o com PomodoroTimerModule
         - IntegraÃ§Ã£o com ContextMenuModule

FASE 2: Refatorar CleanSubtaskItem
â”œâ”€â”€ 2.1. Substituir implementaÃ§Ã£o por SubtaskCard
â”œâ”€â”€ 2.2. Manter compatibilidade de API
â””â”€â”€ 2.3. Testar em TaskDetailPanel

FASE 3: ValidaÃ§Ã£o
â”œâ”€â”€ 3.1. Testar visual (comparar com imagem)
â”œâ”€â”€ 3.2. Testar interaÃ§Ãµes (checkbox, timer, menu)
â”œâ”€â”€ 3.3. Testar responsividade (desktop + mobile)
â””â”€â”€ 3.4. Testar com mÃºltiplas subtarefas


================================================================================
âš ï¸ DECISÃ•ES E TRADE-OFFS
================================================================================

DECISÃƒO 1: âŒ NÃƒO criar CheckboxModule
MOTIVO: Muito simples (~20 linhas), inline Ã© mais direto
RESULTADO: Checkbox fica inline no SubtaskCard

DECISÃƒO 2: âŒ NÃƒO criar EditDeleteModule  
MOTIVO: Redundante com ContextMenuModule.editDelete() factory
RESULTADO: Apenas 1 mÃ³dulo (ContextMenuModule) em vez de 2

DECISÃƒO 3: âœ… ContextMenuModule ENVOLVE ModularCard (nÃ£o Ã© parte dele)
MOTIVO: SeparaÃ§Ã£o de responsabilidades (layout vs gestos)
RESULTADO: ModularCard continua focado apenas em layout

DECISÃƒO 4: âš ï¸ TextField inline â†’ Dialog de ediÃ§Ã£o
MOTIVO: EdiÃ§Ã£o inline no tÃ­tulo Ã© complexa e propensa a bugs
RESULTADO: Clique no tÃ­tulo abre dialog (melhor UX)
BREAKING: textController e onTitleChanged nÃ£o sÃ£o mais usados


================================================================================
ğŸ¯ CRITÃ‰RIOS DE SUCESSO
================================================================================

âœ… CleanSubtaskItem reduzido de 400+ â†’ ~30 linhas
âœ… SubtaskCard criado com ~80 linhas
âœ… ContextMenuModule genÃ©rico e reutilizÃ¡vel
âœ… Visual bate com imagem (checkbox circular, sem bordas)
âœ… Menu de contexto funciona (desktop + mobile)
âœ… Timer funciona com PomodoroTimerModule
âœ… CÃ³digo modular, testÃ¡vel e manutenÃ­vel
âœ… Zero regressÃµes no TaskDetailPanel


================================================================================
ğŸ“š REFERÃŠNCIAS
================================================================================

Arquivos existentes para referÃªncia:
- lib/widgets/common/cards/task_card.dart (padrÃ£o de simplicidade)
- lib/widgets/common/cards/note_card.dart (uso de ModularCard)
- lib/widgets/common/modules/pomodoro_timer_module.dart (mÃ³dulo pronto)
- lib/features/task_management/widgets/lists/list_context_menu.dart (menu desktop/mobile)
- lib/features/task_management/widgets/projects/project_context_menu.dart (menu com validaÃ§Ãµes)
- lib/widgets/common/cards/modules/action_menu_module.dart (PopupMenuButton base)

Imagem de referÃªncia:
- Visual esperado: checkbox circular, layout limpo, sem bordas

================================================================================
FIM DA DOCUMENTAÃ‡ÃƒO
================================================================================
